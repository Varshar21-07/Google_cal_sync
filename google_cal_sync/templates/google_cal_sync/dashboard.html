{% extends "google_cal_sync/base.html" %}

{% block title %}Dashboard â€¢ Calendar Sync{% endblock %}

{% block header %}Today&apos;s Overview{% endblock %}

{% block content %}
{% if not has_token %}
<section class="panel empty-state">
    <div class="empty-state-icon">ğŸ“…</div>
    <h3>Connect Google Calendar</h3>
    <p>Link your Google account to load calendars and upcoming events.</p>
    <a href="{% url 'google_cal_sync:google_oauth_login' %}" class="primary-btn" style="display:inline-block;">
        <span class="btn-icon">ğŸ”—</span>
        Connect Google
    </a>
</section>
{% else %}
{% if api_error %}
<section class="panel error-state">
    <div class="error-icon">âš ï¸</div>
    <strong>Error:</strong> {{ api_error }}
</section>
{% endif %}

<section class="cards-grid">
    {% with next_event=events|first %}
    <article class="info-card info-card-primary">
        <div class="info-card-icon">â°</div>
        <div class="info-card-content">
            <p class="info-label">Next Event</p>
            {% if next_event %}
            <h2 class="info-value">{{ next_event.summary|default:"Unnamed event" }}</h2>
            <p class="info-meta">
                <span class="meta-icon">ğŸ•</span>
                {{ next_event.start_text }}
            </p>
            {% else %}
            <h2 class="info-value">No upcoming events</h2>
            <p class="info-meta">
                <span class="meta-icon">âœ¨</span>
                Your calendar is clear.
            </p>
            {% endif %}
        </div>
    </article>
    {% endwith %}
    <article class="info-card info-card-secondary">
        <div class="info-card-icon">ğŸ“†</div>
        <div class="info-card-content">
            <p class="info-label">Calendars Connected</p>
            <h2 class="info-value">{{ calendars|length }}</h2>
            <p class="info-meta">
                <span class="meta-icon">ğŸ”—</span>
                Primary &amp; shared calendars
            </p>
        </div>
    </article>
    <article class="info-card info-card-tertiary">
        <div class="info-card-icon">ğŸ“‹</div>
        <div class="info-card-content">
            <p class="info-label">Events Loaded</p>
            <h2 class="info-value">{{ events|length }}</h2>
            <p class="info-meta">
                <span class="meta-icon">ğŸ“Œ</span>
                Upcoming items from your calendar
            </p>
        </div>
    </article>
</section>

<section class="panel panel-events">
    <div class="panel-header">
        <div class="panel-header-left">
            <span class="panel-icon">ğŸ“…</span>
            <h3>Upcoming Events</h3>
        </div>
        <a href="{% url 'google_cal_sync:upcoming_events' %}" class="ghost-btn btn-with-icon">
            <span>View all</span>
            <span class="btn-arrow">â†’</span>
        </a>
    </div>
    {% if events %}
    <div class="timeline-container">
        {% for event in events %}
        <div class="event-card event-card-interactive">
            <div class="event-date-badge">
                <span class="event-date-day">{{ event.start_dt|date:"d" }}</span>
                <span class="event-date-month">{{ event.start_dt|date:"M" }}</span>
            </div>
            <div class="event-details">
                <h4 class="event-title">{{ event.summary|default:"Untitled event" }}</h4>
                <div class="event-meta">
                    <div class="event-time-range">
                        <span class="meta-icon-small">ğŸ•</span>
                        {{ event.start_text }}
                    </div>
                    {% if event.location %}
                    <div class="event-location">
                        <span class="meta-icon-small">ğŸ“</span>
                        {{ event.location|truncatewords:5 }}
                    </div>
                    {% endif %}
                </div>
            </div>
            <div class="event-card-actions">
                <a href="{% url 'google_cal_sync:update_event' %}?calendar_id=primary&event_id={{ event.id }}" 
                   class="event-action-btn event-action-edit" title="Edit Event">
                    <span class="action-icon">âœï¸</span>
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-events">
        <div class="empty-events-icon">ğŸ“­</div>
        <p>No upcoming events found.</p>
        <a href="{% url 'google_cal_sync:create_event' %}" class="ghost-btn btn-with-icon">
            <span>Create Event</span>
            <span class="btn-arrow">+</span>
        </a>
    </div>
    {% endif %}
</section>
{% endif %}
{% endblock %}